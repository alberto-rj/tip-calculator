import Listbox from"./list-box.min.js";import DataStore from"./data-store.min.js";const billInput=document.getElementById("bill-input"),tipListbox=document.getElementById("tip-listbox"),customTipInput=document.getElementById("custom-tip-input"),numberOfPeopleInput=document.getElementById("number-of-people-input"),inputs=[billInput,customTipInput,numberOfPeopleInput],resetBtn=document.getElementById("reset-btn"),tipAmountHeading=document.getElementById("tip-amount-heading"),tipAmountData=document.getElementById("tip-amount-data"),totalHeading=document.getElementById("total-heading"),totalData=document.getElementById("total-data"),fadeInElements=[tipAmountHeading,tipAmountData,totalHeading,totalData,resetBtn],listbox=new Listbox(tipListbox);let inputStore=new DataStore;const defaultInputStore=()=>{inputStore.set(billInput.id,null),inputStore.set(customTipInput.id,15),inputStore.set(numberOfPeopleInput.id,null)};defaultInputStore();const addClass=(element,className)=>{element.classList.add(className)},removeClass=(element,className)=>{element.classList.remove(className)},setDisabled=(element,status)=>{status=!0===status,element.disabled=status},setFadeInEffect=elements=>{elements.forEach(((element,index)=>{addClass(element,"fade-in"),index>0&&addClass(element,`fade-in--${index}`)}))},setFadeInReverseEffect=elements=>{for(let i=elements.length-1,j=0;i>=0;i--,j++)addClass(elements[i],"fade-in"),j>0&&addClass(elements[i],`fade-in--${j}`)},calculateData=(bill,tip,nop)=>{let tipAmount=bill*(tip/100);const totalPerPerson=(bill+tipAmount)/nop,tipPerPerson=tipAmount/nop,data={};return data[tipAmountData.id]=tipPerPerson.toFixed(2),data[totalData.id]=totalPerPerson.toFixed(2),data},renderData=data=>{const tip=data[tipAmountData.id];tipAmountData.textContent=`$${tip}`;const total=data[totalData.id];totalData.textContent=`$${total}`},resetData=()=>{const outData={};outData[tipAmountData.id]="0.00",outData[totalData.id]="0.00",renderData(outData)},writeData=()=>{const bill=inputStore.get(billInput.id),tip=inputStore.get(customTipInput.id),nop=inputStore.get(numberOfPeopleInput.id),data=calculateData(bill,tip,nop);renderData(data),setFadeInEffect(fadeInElements),setDisabled(resetBtn,!1)},tryWriteData=()=>{inputStore.hasEmptyKey()||writeData()},setShakeEffect=element=>{addClass(element,"shake")},parentOf=input=>input.closest(".form__field, .form__group"),alertOf=parent=>parent.querySelector(".form__alert"),showInputError=(input,error)=>{const parent=parentOf(input);if(!parent)return;const formAlert=alertOf(parent);formAlert&&(formAlert.textContent=error,input.setAttribute("aria-invalid","true"),input.setAttribute("aria-describedby",formAlert.id),input.focus(),setShakeEffect(input),addClass(parent,"is-invalid"))},clearInputError=input=>{const parent=parentOf(input);if(!parent)return;const formAlert=alertOf(parent);formAlert&&(formAlert.textContent="",input.removeAttribute("aria-invalid"),input.removeAttribute("aria-describedby"),removeClass(parent,"is-invalid"))},validateBill=input=>{const{id:id,value:value}=input,billValue=Number.parseFloat(value);input.checkValidity()&&!Number.isNaN(billValue)?(inputStore.set(id,billValue),clearInputError(input)):(inputStore.set(id,null),showInputError(input,"Enter between 0 and 9999 only"))},validateCustomTip=input=>{const{id:id,value:value}=input,customValue=Number.parseFloat(value);input.checkValidity()&&!Number.isNaN(customValue)?(inputStore.set(id,customValue),clearInputError(input)):(inputStore.set(id,null),showInputError(input,"Enter between 0 and 100 only"))},validateNumberOfPeople=input=>{const{id:id,value:value}=input,nop=Number.parseInt(value);input.checkValidity()&&!Number.isNaN(nop)?(inputStore.set(id,nop),clearInputError(input)):(inputStore.set(id,null),showInputError(input,"Enter between 0 and 100 only"))},resetInput=input=>{clearInputError(input),input.value=""},resetInputs=()=>{inputs.forEach(resetInput)},resetListbox=()=>{listbox.focus(2)},resetFormFields=()=>{resetInputs(),resetListbox()},resetBtnHandler=event=>{setDisabled(event.target,!0),resetData(),setFadeInReverseEffect(fadeInElements),resetFormFields(),defaultInputStore()},shakeAnimationendHandler=event=>{removeClass(event.target,"shake")},fadeInAnimationendHandler=event=>{removeClass(event.target,"fade-in");for(let i=1;i<fadeInElements.length;i++)removeClass(event.target,`fade-in--${i}`)},handleInput=(input,validate)=>{validate(input),tryWriteData()},inputHandlers={};inputHandlers[billInput.id]=event=>{handleInput(event.target,validateBill)},inputHandlers[customTipInput.id]=event=>{listbox.clearSelectedOption(),handleInput(event.target,validateCustomTip)},inputHandlers[numberOfPeopleInput.id]=event=>{handleInput(event.target,validateNumberOfPeople)};const selectionTipHandler=option=>{resetInput(customTipInput);let number=Number.parseFloat(option.dataset.value);Number.isNaN(number)?inputStore.set(customTipInput.id,null):(inputStore.set(customTipInput.id,number),tryWriteData())};inputs.forEach((input=>{input.addEventListener("input",inputHandlers[input.id]),input.addEventListener("animationend",shakeAnimationendHandler)})),fadeInElements.forEach((element=>{element.addEventListener("animationend",fadeInAnimationendHandler)})),resetBtn.addEventListener("click",resetBtnHandler),listbox.onSelected=selectionTipHandler;